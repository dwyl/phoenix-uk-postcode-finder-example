defmodule StoreFinder.CreateStores do
  def get_random_postcodes(n, acc \\ [])
  def get_random_postcodes(0, acc), do: acc
  def get_random_postcodes(n, _acc) when n > 200, do: "Too many postcodes."

  def get_random_postcodes(n, acc) do
    {:ok, {{'HTTP/1.1', 200, 'OK'}, _headers, body}} =
      :httpc.request(:get, {'https://api.postcodes.io/random/postcodes', []}, [], [])

    {:ok, parsed_body} = Jason.decode(body)

    postcode = parsed_body["result"]["postcode"]
    lat = parsed_body["result"]["latitude"]
    long = parsed_body["result"]["longitude"]

    get_random_postcodes(n - 1, [{postcode, lat, long} | acc])
  end

  def cache_store_info(list) do
    :ets.new(:store_cache, [:set, :public, :named_table])

    list
    |> Enum.each(fn({postcode, lat, long}) ->
      :ets.insert_new(:store_cache, {postcode, lat, long})
    end)
  end

  # A "here's one I made earlier" type list
  # so people do not need to call get_random_postcodes themselves
  # will also be useful for testing
  def getStorList do
    [
      {"SK16 4AJ", 53.475273, -2.079783},
      {"IG8 9FD", 51.600469, 0.020355},
      {"M25 3HH", 53.532044, -2.289502},
      {"SL9 8FE", 51.591826, -0.553728},
      {"CV32 6AL", 52.289168, -1.558519},
      {"EN9 3JR", 51.690581, 0.015756},
      {"PR7 5LD", 53.644391, -2.67151},
      {"PE3 9XH", 52.583033, -0.283243},
      {"B23 6SR", 52.522318, -1.843304},
      {"PE11 1BG", 52.787621, -0.153583},
      {"TQ7 4SA", 50.323888, -3.801353},
      {"CT1 1YZ", 51.296282, 1.103652},
      {"SY2 6HQ", 52.689545, -2.732038},
      {"SE12 8NR", 51.453142, 0.006762},
      {"LN5 9AD", 53.19476, -0.549773},
      {"HP7 0PN", 51.645586, -0.654868},
      {"HU5 2NX", 53.764633, -0.357316},
      {"DN21 2PB", 53.407165, -0.78154},
      {"LE13 1AD", 52.763772, -0.879249},
      {"NP10 8LB", 51.577959, -3.041161},
      {"HR1 4BU", 52.06775, -2.644082},
      {"RG20 8JF", 51.461366, -1.428162},
      {"BD7 4DP", 53.775552, -1.794195},
      {"PL11 2QP", 50.379287, -4.215066},
      {"EX34 8QB", 51.199963, -4.124893},
      {"BN2 5JG", 50.817167, -0.112463},
      {"RG1 8DN", 51.464439, -0.976861},
      {"PO10 8AY", 50.846074, -0.924806},
      {"BB4 9BL", 53.694656, -2.246789},
      {"BT71 5PN", 54.592436, -6.699064},
      {"G43 1BJ", 55.820387, -4.297286},
      {"PO30 2AE", 50.696949, -1.287972},
      {"G44 4NR", 55.824072, -4.237103},
      {"CH49 7NL", 53.374641, -3.077944},
      {"PO16 8QL", 50.855061, -1.130245},
      {"SO41 0LP", 50.74666, -1.593416},
      {"B67 6LP", 52.484753, -1.985392},
      {"ST3 1BP", 52.992435, -2.134173},
      {"NR32 1UJ", 52.479908, 1.757555},
      {"CV6 4GW", 52.449854, -1.515774},
      {"G66 8FD", 55.964314, -4.166249},
      {"TN34 2EE", 50.863539, 0.583008},
      {"CO7 6HJ", 51.957933, 0.990292},
      {"AL4 8FH", 51.806496, -0.297804},
      {"CM13 2HR", 51.61847, 0.339097},
      {"TA2 7DY", 51.02729, -3.097332},
      {"FY7 6QG", 53.92469, -3.020541},
      {"TN10 3ES", 51.211847, 0.278637},
      {"SA61 1BW", 51.798922, -4.979514},
      {"NG25 0LX", 53.076382, -0.964699},
      {"L74 4AD", 53.392999, -2.988285},
      {"CM1 2TT", 51.731325, 0.447123},
      {"S6 3EA", 53.389375, -1.484961},
      {"TW16 5PH", 51.408543, -0.399054},
      {"YO11 1LD", 54.281531, -0.402733},
      {"WF2 6AH", 53.66409, -1.48513},
      {"BT53 8DD", 55.114664, -6.441807},
      {"OX2 8ET", 51.794058, -1.272268},
      {"CB4 2TW", 52.231652, 0.128513},
      {"EX39 4QT", 50.973035, -4.167325},
      {"ML8 5NA", 55.722309, -3.835955},
      {"LA8 8PA", 54.272795, -2.790765},
      {"TN15 8HF", 51.290559, 0.309712},
      {"NN8 4TW", 52.314373, -0.688849},
      {"KW10 6TT", 57.970643, -3.982215},
      {"S41 8WE", 53.252108, -1.462659},
      {"CW7 2BY", 53.196892, -2.534115},
      {"LS8 5DU", 53.808447, -1.526678},
      {"S6 1SR", 53.416973, -1.520136},
      {"DN11 0UG", 53.477341, -1.055544},
      {"DN5 8QU", 53.537105, -1.176872},
      {"ME8 1EH", 51.36618, 0.575541},
      {"AB11 6QF", 57.145726, -2.09641},
      {"HU18 1JD", 53.91864, -0.165331},
      {"RG27 8AW", 51.307871, -0.874828},
      {"EC4R 2SH", 51.511441, -0.091256},
      {"RG1 4QT", 51.452379, -0.964379},
      {"NR13 4TQ", 52.623783, 1.494778},
      {"SW10 1AW", 51.484744, -0.183629},
      {"TW4 5EF", 51.460984, -0.38186},
      {"CF39 9NE", 51.60937, -3.398136},
      {"HU7 4SR", 53.78668, -0.304783},
      {"SW17 8JH", 51.433327, -0.15327},
      {"HP6 5PX", 51.680461, -0.619699},
      {"SW17 7DD", 51.437989, -0.164981},
      {"LE18 3SW", 52.575744, -1.097083},
      {"IP18 6RT", 52.338982, 1.664624},
      {"PA16 0DL", 55.915985, -4.849244},
      {"LL17 0EJ", 53.252135, -3.435899},
      {"CT14 9EF", 51.20842, 1.384451},
      {"OX18 3JA", 51.760362, -1.593699},
      {"CV35 9TB", 52.190377, -1.600033},
      {"SO19 9JB", 50.888446, -1.362184},
      {"NR21 7HN", 52.77798, 0.784236},
      {"BT70 1JL", 54.502707, -6.784704},
      {"NN18 8QS", 52.464661, -0.702626},
      {"PL4 0NL", 50.369798, -4.127391},
      {"LS29 7QH", 53.902241, -1.74321},
      {"TS5 8EQ", 54.530129, -1.245368},
      {"N14 6LG", 51.623742, -0.122664},
      {"PL26 8PF", 50.396403, -4.793402},
      {"W13 9ED", 51.506596, -0.323802},
      {"SW10 1BZ", 51.484744, -0.183629},
      {"DD5 3PP", 56.526577, -2.881395},
      {"KT5 8TT", 51.389351, -0.294947},
      {"BS7 9PZ", 51.486207, -2.577093},
      {"E11 1SL", 51.568696, 0.006854},
      {"RH11 6AL", 51.101289, -0.228536},
      {"NE65 0TJ", 55.341394, -1.612685},
      {"TS13 4JP", 54.552442, -0.880689},
      {"HG3 1EH", 53.96706, -1.479012},
      {"SP3 4UL", 51.151793, -1.858819},
      {"HX3 5RE", 53.739254, -1.881376},
      {"TQ13 9QA", 50.61471, -3.653137},
      {"HA8 7PG", 51.614369, -0.280967},
      {"SY12 0DN", 52.90508, -2.899723},
      {"LU5 5PN", 51.911431, -0.510002},
      {"SS12 9NR", 51.602009, 0.535838},
      {"BB18 5AX", 53.912851, -2.185613},
      {"PL21 0PU", 50.348944, -3.88665},
      {"EH16 6EU", 55.90689, -3.157962},
      {"BB18 6XZ", 53.910774, -2.14703},
      {"B45 0HJ", 52.401378, -2.024016},
      {"AL1 1JN", 51.744938, -0.324802},
      {"AB12 9UF", 57.148707, -2.097806},
      {"BS15 1QD", 51.471886, -2.513073},
      {"NE65 0JB", 55.314724, -1.5791},
      {"E12 5HX", 51.554031, 0.051446},
      {"GL1 2JB", 51.865994, -2.24867},
      {"NP7 0DU", 51.826061, -3.092726},
      {"HD8 8ED", 53.586849, -1.70402},
      {"SW11 4NJ", 51.476232, -0.160826},
      {"EH30 9BG", 55.981436, -3.398032},
      {"WA5 0HT", 53.411427, -2.605898},
      {"NE6 4BD", 54.978149, -1.558395},
      {"SY7 0EF", 52.313168, -2.905345},
      {"SP7 8DU", 51.013975, -2.189},
      {"PL35 0HB", 50.690113, -4.692332},
      {"OX29 4TL", 51.776759, -1.378906},
      {"NG20 8DJ", 53.202468, -1.221127},
      {"FK2 9XZ", 55.987858, -3.731992},
      {"RG4 6XD", 51.469983, -0.906694},
      {"RG8 9PP", 51.522689, -1.150482},
      {"WR1 1RE", 52.204902, -2.221348},
      {"DD3 9BZ", 56.489306, -2.995997},
      {"CR7 7NE", 51.401423, -0.115004},
      {"IP32 6AR", 52.252414, 0.713239},
      {"L37 3HA", 53.55774, -3.065505},
      {"SW17 8LG", 51.426657, -0.158573},
      {"DY2 0EF", 52.477553, -2.092153},
      {"NR33 9HT", 52.462463, 1.715555},
      {"BB11 2JA", 53.783384, -2.238963},
      {"EX31 3JR", 51.021469, -4.079607},
      {"BT94 3AG", 54.392334, -7.508087},
      {"SN3 4HZ", 51.573427, -1.736371},
      {"NE15 9AA", 54.995534, -1.754743},
      {"CA1 2WG", 54.891095, -2.909804},
      {"LN11 7JQ", 53.453981, 0.080451},
      {"PO4 0SP", 50.778953, -1.076141},
      {"E15 2RB", 51.532291, -0.008806},
      {"WF16 0JR", 53.706598, -1.672489},
      {"EH10 4SZ", 55.927942, -3.208558},
      {"GU27 3JD", 51.046267, -0.710403},
      {"BH21 3HB", 50.783596, -2.024062},
      {"IG8 9QL", 51.608972, 0.019534},
      {"S12 2JX", 53.345239, -1.427317},
      {"BN9 9RL", 50.792406, 0.049432},
      {"PL3 4HP", 50.3819, -4.154518},
      {"PL21 9JX", 50.359453, -3.941438},
      {"GL6 8BP", 51.727424, -2.148312},
      {"SA38 9AQ", 52.038825, -4.466857},
      {"HX6 1BX", 53.705763, -1.925538},
      {"M28 8BY", 53.51305, -2.362208},
      {"EX22 6LP", 50.808246, -4.385097},
      {"NN6 9JZ", 52.347298, -0.872178},
      {"PH11 8BL", 56.621432, -3.235278},
      {"BB7 4DP", 53.904692, -2.306884},
      {"NG9 5BN", 52.91699, -1.230094},
      {"DD1 5PZ", 56.462, -2.992929},
      {"KA20 4LB", 55.656437, -4.745476},
      {"WS12 4BE", 52.714865, -2.007507},
      {"PE11 1PH", 52.793577, -0.159634},
      {"DL7 9EY", 54.284446, -1.437977},
      {"NP13 3LG", 51.770655, -3.154807},
      {"BA10 0EF", 51.110638, -2.454249},
      {"ME17 4EF", 51.230482, 0.505126},
      {"EH54 8DT", 55.899656, -3.558709},
      {"NE64 6BJ", 55.190769, -1.511266},
      {"SO16 7GD", 50.952171, -1.405602},
      {"FK6 5NS", 56.008291, -3.911527},
      {"NG24 2QA", 53.08076, -0.757961},
      {"CO9 4NR", 52.021181, 0.505727},
      {"SK13 7PW", 53.428304, -1.942366},
      {"BD5 0BA", 53.789366, -1.758364},
      {"NP26 3HP", 51.582736, -2.833669},
      {"BT49 0LR", 55.178607, -6.95165},
      {"SN16 0QH", 51.587217, -2.113762}
    ]
  end
end
